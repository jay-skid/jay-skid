<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nick vs Maxwell — Online Poll</title>
  <style>
    body {font-family: system-ui; display:flex; justify-content:center; align-items:center; height:100vh; background:#f5f7fb;}
    .card {background:#fff; padding:20px; border-radius:12px; width:360px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
    h1 {font-size:20px; margin-bottom:10px;}
    button {padding:8px 12px; border:none; border-radius:6px; cursor:pointer; background:#0b63d4; color:#fff;}
    button:disabled {opacity:0.6;}
    .bar {height:10px; background:#e9eef8; border-radius:6px; overflow:hidden; margin-top:10px;}
    .bar > i {display:block; height:100%; background:#0b63d4; width:0;}
  </style>
</head>
<body>
  <div class="card">
    <h1>Vote: Nick or Maxwell</h1>
    <p>Everyone’s votes are counted live.</p>

    <div>
      <button id="voteNick">Vote Nick</button>
      <button id="voteMaxwell">Vote Maxwell</button>
    </div>

    <p id="results">Loading votes...</p>
    <div class="bar"><i id="bar"></i></div>
  </div>

  <script>
    const BIN_ID = "6902bd0dae596e708f36ddf2";  // example: 671b3e21e41b4d34a7f1c123
    const API_KEY = "$2a$10$DQjUOefBBtS19uZtTBy6l.WzDKfr1TAibr5FSE0OW12.UaPj1GQQa"; // <-- keep private
    const BASE_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

    const resultsEl = document.getElementById('results');
    const barEl = document.getElementById('bar');
    const btnNick = document.getElementById('voteNick');
    const btnMaxwell = document.getElementById('voteMaxwell');

    async function getVotes() {
      const res = await fetch(BASE_URL, {
        headers: { 'X-Master-Key': API_KEY }
      });
      const data = await res.json();
      return data.record;
    }

    async function updateVotes(newData) {
      await fetch(BASE_URL, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'X-Master-Key': API_KEY
        },
        body: JSON.stringify(newData)
      });
    }

    async function render() {
      const votes = await getVotes();
      const total = votes.nick + votes.maxwell;
      const pctNick = total ? Math.round((votes.nick / total) * 100) : 0;

      resultsEl.textContent = `Nick: ${votes.nick} | Maxwell: ${votes.maxwell} (Total: ${total})`;
      barEl.style.width = pctNick + '%';
      barEl.title = `Nick ${pctNick}%, Maxwell ${100 - pctNick}%`;
    }

    async function vote(name) {
      const votes = await getVotes();
      votes[name]++;
      await updateVotes(votes);
      render();
    }

    btnNick.onclick = () => vote('nick');
    btnMaxwell.onclick = () => vote('maxwell');

    render();
  </script>
</body>
</html>
